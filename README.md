# SkillToken - Контракт для управления сертификатами навыков

Этот проект содержит смарт-контракт `SkillToken` для управления сертификатами навыков, написанный на Solidity, с полным набором тестов на TypeScript.

## Функциональность

SkillToken позволяет:
- Владельцу добавлять новые сертификаты с указанием цены и количества
- Пользователям покупать сертификаты за ETH
- Владельцу помечать заказы как доставленные
- Получать список всех доступных сертификатов
- Отслеживать статус заказов

## Установка

```bash
npm install
```

## Команды для тестирования

### Запуск тестов с автоматическим coverage
```bash
npm test
```
Эта команда запускает тесты и сразу после них анализ покрытия кода.

### Запуск только тестов
```bash
npm run test-only
```

### Запуск только анализа покрытия
```bash
npm run coverage
```

### Другие полезные команды
```bash
# Компиляция контракта
npm run compile

# Очистка артефактов
npm run clean

# Запуск локальной ноды Hardhat
npm run node
```

## Структура тестов

Тесты находятся в файле `test/SkillToken.test.ts` и покрывают:

### Основные функции:
- ✅ Деплой контракта
- ✅ Добавление сертификатов (только владелец)
- ✅ Покупка сертификатов с валидацией цены и количества
- ✅ Доставка заказов (только владелец)
- ✅ Получение списка сертификатов

### Модификаторы и безопасность:
- ✅ Ограничения доступа (`onlyOwner`)
- ✅ Валидация входных данных
- ✅ Защита от прямых переводов ETH
- ✅ Fallback функция

### События:
- ✅ `CertificateBought` при покупке
- ✅ `CertificateDelivered` при доставке

### Граничные случаи:
- ✅ Покупка последнего сертификата
- ✅ Сертификаты с нулевой ценой
- ✅ Большие количества
- ✅ Пустые строки в данных
- ✅ Несуществующие индексы

### Интеграционные тесты:
- ✅ Полный цикл: добавление → покупка → доставка
- ✅ Множественные покупки и доставки

## Покрытие кода

После запуска `npm test` или `npm run coverage` будет сгенерирован отчет о покрытии:

- **SkillToken.sol**: 100% покрытие функций, строк и веток
- Отчеты сохраняются в папке `./coverage/`
- HTML отчет доступен в `./coverage/index.html`

## Результат последнего тестирования

```
  36 passing (431ms)

File                     |  % Stmts | % Branch |  % Funcs |  % Lines |
-------------------------|----------|----------|----------|----------|
 SkillToken.sol         |      100 |      100 |      100 |      100 |
```

## Архитектура тестов

### Фикстуры:
- `deploySkillTokenFixture`: Базовый деплой контракта
- `deployWithCertificateFixture`: Деплой с предустановленным сертификатом

### Группы тестов:
1. **Деплой** - проверка корректной инициализации
2. **Добавление сертификатов** - тестирование функции `addCertificate`
3. **Покупка сертификатов** - тестирование функции `buy`
4. **Доставка заказов** - тестирование функции `delivered`
5. **Получение списка** - тестирование функции `allCertificates`
6. **Прямые переводы** - тестирование `receive()` и fallback
7. **Интеграционные тесты** - комплексные сценарии
8. **Граничные случаи** - экстремальные значения

## Настройка автоматического запуска

Благодаря настройке в `package.json`, команда `npm test` автоматически:
1. Запускает все тесты
2. Проверяет их успешность
3. Если тесты прошли, запускает анализ покрытия
4. Генерирует подробный отчет

Это обеспечивает максимальное удобство разработки и контроля качества кода.

## Дополнительные файлы

- `.solcover.js` - конфигурация для solidity-coverage
- `hardhat.config.ts` - настройки Hardhat с поддержкой TypeScript и coverage
- `typechain-types/` - автоматически сгенерированные типы TypeScript
