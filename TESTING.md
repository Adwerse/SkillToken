# Руководство по тестированию SkillToken

## Обзор покрытия тестами

### SkillToken.sol - 100% покрытие
Наш основной контракт `SkillToken.sol` имеет **100% покрытие** по всем метрикам:

| Метрика | Покрытие | Описание |
|---------|----------|----------|
| Statements | 100% | Все операторы выполнены |
| Branches | 100% | Все условные ветки протестированы |
| Functions | 100% | Все функции вызваны |
| Lines | 100% | Все строки кода выполнены |

## Детальное покрытие функций

### ✅ Конструктор
```solidity
constructor(address _owner)
```
- Тестируется установка владельца

### ✅ addCertificate
```solidity
function addCertificate(bytes32 uid, string calldata title, ...)
```
Покрытые сценарии:
- ✅ Успешное добавление сертификата владельцем
- ✅ Отклонение вызова НЕ-владельцем (модификатор `onlyOwner`)
- ✅ Увеличение `currentIndex`
- ✅ Корректное сохранение всех параметров

### ✅ buy
```solidity
function buy(uint256 _index) external payable
```
Покрытые сценарии:
- ✅ Успешная покупка с правильной ценой
- ✅ Отклонение при неправильной цене (слишком мало/много)
- ✅ Отклонение при отсутствии товара (`quantity = 0`)
- ✅ Уменьшение количества после покупки
- ✅ Создание заказа с правильными данными
- ✅ Испускание события `CertificateBought`
- ✅ Увеличение `currentOrderId`

### ✅ delivered
```solidity
function delivered(uint256 _index) external onlyOwner
```
Покрытые сценарии:
- ✅ Успешная пометка как доставленный владельцем
- ✅ Отклонение вызова НЕ-владельцем
- ✅ Отклонение повторной доставки
- ✅ Испускание события `CertificateDelivered`

### ✅ receive
```solidity
receive() external payable
```
Покрытые сценарии:
- ✅ Отклонение прямых переводов ETH
- ✅ Корректное сообщение об ошибке

### ✅ fallback
```solidity
fallback() external
```
Покрытые сценарии:
- ✅ Обработка вызовов с данными
- ✅ Логирование входящих данных

### ✅ allCertificates
```solidity
function allCertificates() external view returns (Certificate[] memory)
```
Покрытые сценарии:
- ✅ Возврат пустого массива
- ✅ Возврат всех сертификатов
- ✅ Актуальные количества после покупок

## Покрытие модификаторов

### ✅ onlyOwner
```solidity
modifier onlyOwner()
```
Тестируется в функциях:
- `addCertificate` - ✅ доступ владельца, ❌ доступ НЕ-владельца
- `delivered` - ✅ доступ владельца, ❌ доступ НЕ-владельца

## Покрытие событий

### ✅ CertificateBought
```solidity
event CertificateBought(bytes32 indexed uid, address indexed customer, uint256 indexed timestamp)
```
- ✅ Испускается при успешной покупке
- ✅ Правильные параметры в событии

### ✅ CertificateDelivered
```solidity
event CertificateDelivered(bytes32 indexed certificateUid, address indexed customer)
```
- ✅ Испускается при пометке доставки
- ✅ Правильные параметры в событии

## Покрытие состояний (State Variables)

### ✅ certificates
- ✅ Добавление элементов
- ✅ Чтение элементов
- ✅ Модификация количества

### ✅ orders
- ✅ Добавление заказов
- ✅ Чтение заказов
- ✅ Изменение статуса

### ✅ currentIndex
- ✅ Инициализация (0)
- ✅ Увеличение при добавлении сертификатов

### ✅ currentOrderId
- ✅ Инициализация (0)
- ✅ Увеличение при покупках

### ✅ owner
- ✅ Установка в конструкторе
- ✅ Чтение значения

## Покрытие энумов

### ✅ OrderStatus
```solidity
enum OrderStatus { Paid, Delivered }
```
- ✅ `Paid` - устанавливается при покупке
- ✅ `Delivered` - устанавливается при доставке

## Граничные случаи

### ✅ Экстремальные значения
- ✅ Цена = 0 (бесплатные сертификаты)
- ✅ Очень высокие цены (1000 ETH)
- ✅ Большие количества (1,000,000)

### ✅ Пустые данные
- ✅ Пустые строки в названии, описании, преподавателе
- ✅ Нулевые значения где допустимо

### ✅ Несуществующие индексы
- ✅ Попытка покупки несуществующего сертификата
- ✅ Попытка доставки несуществующего заказа

## Интеграционное тестирование

### ✅ Полный жизненный цикл
1. Деплой контракта
2. Добавление сертификата владельцем
3. Покупка сертификата пользователем
4. Доставка заказа владельцем

### ✅ Множественные операции
- Несколько сертификатов
- Несколько покупателей
- Несколько заказов

## Команды для анализа

### Запуск полного тестирования
```bash
npm test
```

### Только тесты (без coverage)
```bash
npm run test-only
```

### Только анализ покрытия
```bash
npm run coverage
```

### Просмотр HTML отчета
После запуска coverage откройте файл:
```
./coverage/index.html
```

## Интерпретация результатов

### Хорошие показатели:
- **Statements**: > 95%
- **Branches**: > 90%
- **Functions**: 100%
- **Lines**: > 95%

### Наши результаты для SkillToken:
- **Statements**: 100% ✅
- **Branches**: 100% ✅
- **Functions**: 100% ✅
- **Lines**: 100% ✅

## Continuous Integration

Настроенные скрипты позволяют легко интегрировать тестирование в CI/CD:

```yaml
# Пример для GitHub Actions
- name: Run tests with coverage
  run: npm test
```

Команда `npm test` автоматически:
1. Запускает все тесты
2. Проверяет их прохождение
3. Генерирует отчет о покрытии
4. Создает HTML и JSON отчеты

Это обеспечивает высокое качество кода и уверенность в его корректности. 